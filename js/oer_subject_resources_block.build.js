!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,s){return t&&r(e.prototype,t),s&&r(e,s),e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var s,n=p(e);if(t){var r=p(this).constructor;s=Reflect.construct(n,arguments,r)}else s=n.apply(this,arguments);return o(this,s)}}function o(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=wp.i18n.__,d=wp.blocks.registerBlockType,b=wp.blockEditor.InspectorControls,f=wp.components.SelectControl,h=wp.element.Component,v=wp.components.CheckboxControl,w=(wp.components.NumberControl,wp.components.TextControl,wp.element.createElement,wp.components.PanelBody),S=wp.components.PanelRow;wp.element.useState;String.prototype.ucwords=function(){return str=this.toLowerCase(),str.replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,(function(e){return e.toUpperCase()}))};var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(s,e);var t=c(s);function s(e){var r;return n(this,s),(r=t.apply(this,arguments)).state=r.constructor.getInitialState(r.props.attributes.selectedSubjectResources),r.props=e,r.getSubjectAreas=r.getSubjectAreas.bind(u(r)),r.sortSubjects=r.sortSubjects.bind(u(r)),r.getChildSubjects=r.getChildSubjects.bind(u(r)),r.selectResources=r.selectResources.bind(u(r)),r.getSubjectAreas(),r.selectResources(),r.onChangeDisplayCount=r.onChangeDisplayCount.bind(u(r)),r.onChangeSelectedSubject=r.onChangeSelectedSubject.bind(u(r)),r.onChangeSorting=r.onChangeSorting.bind(u(r)),r}return l(s,null,[{key:"getInitialState",value:function(e){return{posts:[],subjects:[],childSubjects:[],post:{},selectedSubjectResources:e}}}]),l(s,[{key:"getOptions",value:function(){var e=this;return(new wp.api.collections.Posts).fetch().then((function(t){if(void 0!==e.state.selectedSubject)if(t&&0!==e.state.selectedSubject){var s=t.find((function(t){return t.id==e.state.selectedSubject}));e.setState({post:s,posts:t})}else e.setState({posts:t})}))}},{key:"getSubjectAreas",value:function(){var e=this,t=new wp.api.models.ResourceSubjectArea,s=[];for(i=1;i<=5;i++)t.fetch({data:{per_page:100,page:i}}).then((function(t){t.length>0&&(s=[].concat.apply(s,t),e.setState({subjects:s}))}));return s}},{key:"onChangeDisplayCount",value:function(e){this.setState({displayCount:e}),this.props.setAttributes({displayCount:e})}},{key:"onChangeSelectedSubject",value:function(e){var t=this.state.posts.find((function(t){return t.id==parseInt(e)}));this.setState({selectedSubject:parseInt(e),post:t}),this.props.setAttributes({selectedSubject:parseInt(e),title:t.title.rendered,content:t.excerpt.rendered,link:t.link})}},{key:"onChangeSorting",value:function(e){this.setState({sort:e}),this.props.setAttributes({sort:e})}},{key:"sortSubjects",value:function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}},{key:"getChildSubjects",value:function(e){var t=this,s=new wp.api.models.ResourceSubjectArea,n=[];s.fetch({data:{per_page:100,parent:e}}).then((function(e){if(e.length>0)return n=(n=[].concat.apply(n,e)).sort(t.sortSubjects),t.setState({childSubjects:n}),n}))}},{key:"selectResources",value:function(){var e=this,t=this.props.attributes.selectedSubjects,s=this.props.attributes.displayCount,n=this.props.attributes.sort,r=new wp.api.collections.Resource;void 0!==this.state.selectedSubjectResources?this.state.selectedSubjectResources.length>0&&(this.setState({selectedSubjectResources:this.state.selectedSubjectResources}),this.props.setAttributes({selectedSubjectResources:this.state.selectedSubjectResources})):r.fetch({data:{per_page:s,orderby:n,order:"asc","resource-subject-area":t}}).then((function(t){e.setState({selectedSubjectResources:t}),e.props.setAttributes({selectedSubjectResources:t})}))}},{key:"render",value:function(){m("Select a Subject");var e,t,s,n=[],r=[],l={},a="",c=(m("Loading Resources"),[]),o=[{value:"5",label:m("5")},{value:"10",label:m("10")},{value:"15",label:m("15")},{value:"20",label:m("20")},{value:"25",label:m("25")},{value:"30",label:m("30")}],u=[{value:"modified",label:m("Date Updated")},{value:"date",label:m("Date Added")},{value:"title",label:m("Title a-z")}];this.props.className+="loading",this.state.subjects=this.state.subjects.sort((function(e,t){return e.name-t.name})),void 0!==this.state.subjects&&this.state.subjects.forEach((function(e){0==e.parent?n.push({value:e.id,label:e.name}):(t=e.parent,void 0===l[e.parent]?l[t]=[{value:e.id,label:e.name}]:l[t].push({value:e.id,label:e.name}))}));var i,p=this;if(n=n.sort(this.sortSubjects),jQuery.each(n,(function(e,t){i=!!p.props.attributes.selectedSubjects&&p.props.attributes.selectedSubjects.indexOf(t.value)>-1;var s="subject-"+t.value;r.push(wp.element.createElement(v,{value:t.value,label:t.label,name:"selectedSubjects[]",checked:i,id:s,onChange:function(e){var n=p.props.attributes.selectedSubjects?p.props.attributes.selectedSubjects:[];e?(void 0!==n?-1===n.indexOf(t.value)&&n.push(t.value):n.push(t.value),i=!0):(n=p.props.attributes.selectedSubjects.filter((function(e){return e!==t.value})),i=!1),jQuery("#"+s).prop("checked",!1),p.props.setAttributes({selectedSubjects:n})}}));var n,a=l[t.value];a=a.sort(p.sortSubjects),jQuery.each(a,(function(e,t){n=!!p.props.attributes.selectedSubjects&&p.props.attributes.selectedSubjects.indexOf(t.value)>-1;var l="subject-"+t.value;r.push(wp.element.createElement(v,{value:t.value,label:t.label,name:"selectedSubjects[]",checked:n,id:l,className:"oer-child-subject",onChange:function(e){var r=p.props.attributes.selectedSubjects?p.props.attributes.selectedSubjects:[];e?(void 0!==r?-1===r.indexOf(t.value)&&r.push(t.value):r.push(t.value),n=!0):(r=p.props.attributes.selectedSubjects.filter((function(e){return e!==t.value})),n=!1),jQuery("#"+s).prop("checked",n),p.props.setAttributes({selectedSubjects:r})}}))}))})),void 0!==this.state.selectedSubjectResources&&this.state.selectedSubjectResources.length>0){e=u.map((function(e,t){return wp.element.createElement("li",{value:e.value},e.label)})),void 0!==this.props.attributes&&(a=this.props.attributes.sort.ucwords());var d="Browse "+this.state.selectedSubjectResources.length.toString()+" resources";s=wp.element.createElement("div",{className:"oer-snglrsrchdng"},d,wp.element.createElement("div",{className:"sort-box"},wp.element.createElement("span",{className:"sortoption"},a),wp.element.createElement("span",{className:"sort-resources",title:"Sort resources",tabindex:"0",role:"button"},wp.element.createElement("i",{class:"fa fa-sort","aria-hidden":"true"})),wp.element.createElement("div",{className:"sort-options"},wp.element.createElement("ul",null,e)),wp.element.createElement(f,{className:"sort-selectbox",value:this.props.attributes.sort,options:u}))),this.state.selectedSubjectResources.map((function(e,t){var s=[];e.subject_details.map((function(e,t){s.push(wp.element.createElement("span",null,wp.element.createElement("a",{href:e.link},e.name)))})),c.push(wp.element.createElement("div",{className:"post oer-snglrsrc"},wp.element.createElement("a",{href:e.link,className:"oer-resource-link"},wp.element.createElement("div",{className:"oer-snglimglft"},wp.element.createElement("img",{src:e.fimg_url}))),wp.element.createElement("div",{className:"oer-snglttldscrght"},wp.element.createElement("div",{className:"ttl"},wp.element.createElement("a",{href:e.link},e.title.rendered)),wp.element.createElement("div",{className:"post-meta"},wp.element.createElement("span",{className:"post-meta-box post-meta-grades"},wp.element.createElement("strong",null,"Grades: "),e.oer_grade),wp.element.createElement("span",{className:"post-meta-box post-meta-domain"},wp.element.createElement("strong",null,"Domain: "),wp.element.createElement("a",{href:e.link},e.domain))),wp.element.createElement("div",{className:"desc"},wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:e.resource_excerpt}})),wp.element.createElement("div",{className:"tagcloud"},s))))}))}return[!!this.props.isSelected&&wp.element.createElement(b,{key:"subjectOptions"},wp.element.createElement(w,{title:"OER Subject Resources Option",initialOpen:!0,className:"subject-block"},wp.element.createElement(S,null,wp.element.createElement("div",{className:"form-group"},wp.element.createElement(f,{label:m("# of Resources to display:"),value:this.props.attributes.displayCount,options:o,onChange:this.onChangeDisplayCount})),wp.element.createElement("div",{className:"form-group oer-inspector-subjects"},wp.element.createElement("label",null,"Select subject(s);"),wp.element.createElement("div",{className:"editor-post-taxonomies__hierarchical-terms-list"},r)),wp.element.createElement("div",{className:"form-group"},wp.element.createElement(f,{label:m("Sort:"),value:this.props.attributes.sort,options:u,onChange:this.onChangeSorting}))))),wp.element.createElement("div",{className:this.props.className},s,wp.element.createElement("div",{className:"oer-allftrdrsrccntr"},c))]}}]),s}(h);d("wp-oer-plugin/oer-subject-resources-block",{title:m("OER Subject Resources"),category:"widgets",icon:{foreground:"#121212",src:"media-document"},keywords:[m("OER"),m("Resource"),m("Subject Areas")],attributes:{content:{type:"string",selector:"p"},title:{type:"string",selector:"h2"},link:{type:"string",selector:"a"},displayCount:{type:"string"},selectedSubject:{type:"number",default:0},sort:{type:"string",default:"modified"},selectedSubjectResources:{type:"array"},subjects:{type:"array"},selectedSubjects:{type:"array"},childSubjects:{type:"array"}},edit:j,save:function(e){var t,s,n=[{value:"modified",label:m("Date Updated")},{value:"date",label:m("Date Added")},{value:"title",label:m("Title a-z")}],r=[],l="";if(void 0!==e.attributes.selectedSubjectResources&&e.attributes.selectedSubjectResources.length>0){s=n.map((function(e,t){return wp.element.createElement("li",{value:e.value},e.label)})),void 0!==e.attributes&&(l=e.attributes.sort.ucwords());var a="Browse "+e.attributes.selectedSubjectResources.length.toString()+" resources";t=wp.element.createElement("div",{className:"oer-snglrsrchdng"},a,wp.element.createElement("div",{className:"sort-box"},wp.element.createElement("span",{className:"sortoption"},l),wp.element.createElement("span",{className:"sort-resources",title:"Sort resources",tabindex:"0",role:"button"},wp.element.createElement("i",{className:"fa fa-sort","aria-hidden":"true"})),wp.element.createElement("div",{className:"sort-options"},wp.element.createElement("ul",null,s)),wp.element.createElement(f,{className:"sort-selectbox",value:e.attributes.sort,options:n}))),e.attributes.selectedSubjectResources.map((function(e,t){var s=[];e.subject_details.map((function(e,t){s.push(wp.element.createElement("span",null,wp.element.createElement("a",{href:e.link},e.name)))})),r.push(wp.element.createElement("div",{className:"post oer-snglrsrc"},wp.element.createElement("a",{href:e.link,className:"oer-resource-link"},wp.element.createElement("div",{className:"oer-snglimglft"},wp.element.createElement("img",{src:e.fimg_url}))),wp.element.createElement("div",{className:"oer-snglttldscrght"},wp.element.createElement("div",{className:"ttl"},wp.element.createElement("a",{href:e.link},e.title.rendered)),wp.element.createElement("div",{className:"post-meta"},wp.element.createElement("span",{className:"post-meta-box post-meta-grades"},wp.element.createElement("strong",null,"Grades: "),e.oer_grade),wp.element.createElement("span",{className:"post-meta-box post-meta-domain"},wp.element.createElement("strong",null,"Domain: "),wp.element.createElement("a",{href:e.link},e.domain))),wp.element.createElement("div",{className:"desc"},wp.element.createElement("div",{dangerouslySetInnerHTML:{__html:e.resource_excerpt}})),wp.element.createElement("div",{className:"tagcloud"},s))))}))}return wp.element.createElement("div",{className:e.className},t,wp.element.createElement("div",{className:"oer-allftrdrsrccntr"},r))}})}]);