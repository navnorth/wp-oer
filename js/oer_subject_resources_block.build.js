!function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function l(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=p(e);if(t){var r=p(this).constructor;n=Reflect.construct(s,arguments,r)}else n=s.apply(this,arguments);return o(this,n)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=wp.i18n.__,d=wp.blocks.registerBlockType,b=wp.blockEditor.InspectorControls,f=wp.components.SelectControl,h=wp.element.Component,v=wp.components.CheckboxControl,g=(wp.components.NumberControl,wp.components.TextControl,wp.element.createElement,wp.components.PanelBody),S=wp.components.PanelRow,w=(wp.element.useState,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,e);var t=c(n);function n(e){var r;return s(this,n),(r=t.apply(this,arguments)).state=r.constructor.getInitialState(r.props.attributes.selectedSubjectResources),r.props=e,r.getSubjectAreas=r.getSubjectAreas.bind(u(r)),r.sortSubjects=r.sortSubjects.bind(u(r)),r.getChildSubjects=r.getChildSubjects.bind(u(r)),r.selectResources=r.selectResources.bind(u(r)),r.getSubjectAreas(),r.selectResources(),r.onChangeDisplayCount=r.onChangeDisplayCount.bind(u(r)),r.onChangeSelectedSubject=r.onChangeSelectedSubject.bind(u(r)),r.onChangeSorting=r.onChangeSorting.bind(u(r)),r}return l(n,null,[{key:"getInitialState",value:function(e,t){return{posts:[],subjects:[],selectedSubjects:e,childSubjects:[],post:{},selectedSubjectResources:t}}}]),l(n,[{key:"getOptions",value:function(){var e=this;return(new wp.api.collections.Posts).fetch().then((function(t){if(void 0!==e.state.selectedSubject)if(t&&0!==e.state.selectedSubject){var n=t.find((function(t){return t.id==e.state.selectedSubject}));e.setState({post:n,posts:t})}else e.setState({posts:t})}))}},{key:"getSubjectAreas",value:function(){var e=this,t=new wp.api.models.ResourceSubjectArea,n=[];for(i=1;i<=5;i++)t.fetch({data:{per_page:100,page:i}}).then((function(t){t.length>0&&(n=[].concat.apply(n,t),e.setState({subjects:n}))}));return n}},{key:"onChangeDisplayCount",value:function(e){this.setState({displayCount:e}),this.props.setAttributes({displayCount:e})}},{key:"onChangeSelectedSubject",value:function(e){var t=this.state.posts.find((function(t){return t.id==parseInt(e)}));this.setState({selectedSubject:parseInt(e),post:t}),this.props.setAttributes({selectedSubject:parseInt(e),title:t.title.rendered,content:t.excerpt.rendered,link:t.link})}},{key:"onChangeSorting",value:function(e){this.setState({sort:e}),this.props.setAttributes({sort:e})}},{key:"sortSubjects",value:function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}},{key:"getChildSubjects",value:function(e){var t=this,n=new wp.api.models.ResourceSubjectArea,s=[];n.fetch({data:{per_page:100,parent:e}}).then((function(e){if(e.length>0)return s=(s=[].concat.apply(s,e)).sort(t.sortSubjects),t.setState({childSubjects:s}),s}))}},{key:"selectResources",value:function(){var e=this,t=this.state.selectedSubjects,n=this.props.attributes.displayCount,s=this.props.attributes.sort;(new wp.api.collections.Resource).fetch({data:{per_page:n,orderby:s,order:"asc",resource_subject_area:t}}).then((function(t){e.setState({selectedSubjectResources:t}),e.props.setAttributes({selectedSubjectResources:t})}))}},{key:"render",value:function(){m("Select a Subject");var e,t,n=[],s=[],r={},l=(m("Loading Resources"),[]),a=m("Browse %d resources"),c=[{value:"5",label:m("5")},{value:"10",label:m("10")},{value:"15",label:m("15")},{value:"20",label:m("20")},{value:"25",label:m("25")},{value:"30",label:m("30")}],o=[{value:"modified",label:m("Date Updated")},{value:"date",label:m("Date Added")},{value:"title",label:m("Title a-z")}];this.props.className+="loading",this.state.subjects=this.state.subjects.sort((function(e,t){return e.name-t.name})),void 0!==this.state.subjects&&this.state.subjects.forEach((function(e){0==e.parent?n.push({value:e.id,label:e.name}):(t=e.parent,void 0===r[e.parent]?r[t]=[{value:e.id,label:e.name}]:r[t].push({value:e.id,label:e.name}))}));var u,i=this;if(n=n.sort(this.sortSubjects),jQuery.each(n,(function(e,t){u=!!i.props.attributes.selectedSubjects&&i.props.attributes.selectedSubjects.indexOf(t.value)>-1;var n="subject-"+t.value;s.push(wp.element.createElement(v,{value:t.value,label:t.label,name:"selectedSubjects[]",checked:u,id:n,onChange:function(e){var s=i.props.attributes.selectedSubjects?i.props.attributes.selectedSubjects:[];e?(void 0!==s?-1===s.indexOf(t.value)&&s.push(t.value):s.push(t.value),u=!0):(s=i.props.attributes.selectedSubjects.filter((function(e){return e!==t.value})),u=!1),jQuery("#"+n).prop("checked",!1),i.props.setAttributes({selectedSubjects:s}),i.selectResources(s)}}));var l,a=r[t.value];a=a.sort(i.sortSubjects),jQuery.each(a,(function(e,t){l=!!i.props.attributes.selectedSubjects&&i.props.attributes.selectedSubjects.indexOf(t.value)>-1;var r="subject-"+t.value;s.push(wp.element.createElement(v,{value:t.value,label:t.label,name:"selectedSubjects[]",checked:l,id:r,className:"oer-child-subject",onChange:function(e){var s=i.props.attributes.selectedSubjects?i.props.attributes.selectedSubjects:[];e?(void 0!==s?-1===s.indexOf(t.value)&&s.push(t.value):s.push(t.value),l=!0):(s=i.props.attributes.selectedSubjects.filter((function(e){return e!==t.value})),l=!1),jQuery("#"+n).prop("checked",l),i.props.setAttributes({selectedSubjects:s}),i.selectResources(s)}}))}))})),void 0!==this.state.post?this.state.post.hasOwnProperty("title")&&(wp.element.createElement("div",{className:"post"},wp.element.createElement("a",{href:this.state.post.link},wp.element.createElement("h2",{dangerouslySetInnerHTML:{__html:this.state.post.title.rendered}})),wp.element.createElement("p",{dangerouslySetInnerHTML:{__html:this.state.post.excerpt.rendered}})),this.props.className+=" oer-allftrdrsrc has-post"):this.props.className+=" oer-allftrdrsrc no-post",void 0!==this.state.selectedSubjectResources&&this.state.selectedSubjectResources.length>0){e=o.map((function(e,t){return wp.element.createElement("option",{value:e.value},e.label)}));var p=a.replace("%d",this.state.selectedSubjectResources.length);a=wp.element.createElement("div",{className:"oer-snglrsrchdng"},p,wp.element.createElement("div",{class:"sort-box"},e)),this.state.selectedSubjectResources.map((function(e,t){var n=[];e.subject_details.map((function(e,t){n.push(wp.element.createElement("span",null,wp.element.createElement("a",{href:e.link},e.name)))})),l.push(wp.element.createElement("div",{className:"post oer-snglrsrc"},wp.element.createElement("a",{href:e.link,className:"oer-resource-link"},wp.element.createElement("div",{className:"oer-snglimglft"},wp.element.createElement("img",{src:e.fimg_url}))),wp.element.createElement("div",{className:"oer-snglttldscrght"},wp.element.createElement("div",{className:"ttl"},wp.element.createElement("a",{href:e.link},wp.element.createElement("h2",{dangerouslySetInnerHTML:{__html:e.title.rendered}}))),wp.element.createElement("div",{className:"post-meta"},wp.element.createElement("span",{className:"post-meta-box post-meta-grades"},wp.element.createElement("strong",null,"Grades: "),e.oer_grade),wp.element.createElement("span",{className:"post-meta-box post-meta-domain"},wp.element.createElement("strong",null,"Domain: "),wp.element.createElement("a",{href:e.link,target:"_blank"},e.domain))),wp.element.createElement("div",{className:"desc"},wp.element.createElement("p",{dangerouslySetInnerHTML:{__html:e.content.rendered}})),wp.element.createElement("div",{className:"tagcloud"},n))))}))}return[!!this.props.isSelected&&wp.element.createElement(b,{key:"subjectOptions"},wp.element.createElement(g,{title:"OER Subject Resources Option",initialOpen:!0,className:"subject-block"},wp.element.createElement(S,null,wp.element.createElement("div",{className:"form-group"},wp.element.createElement(f,{label:m("# of Resources to display:"),value:this.props.attributes.displayCount,options:c,onChange:this.onChangeDisplayCount})),wp.element.createElement("div",{className:"form-group oer-inspector-subjects"},wp.element.createElement("label",null,"Select subject(s);"),wp.element.createElement("div",{className:"editor-post-taxonomies__hierarchical-terms-list"},s)),wp.element.createElement("div",{className:"form-group"},wp.element.createElement(f,{label:m("Sort:"),value:this.props.attributes.sort,options:o,onChange:this.onChangeSorting}))))),wp.element.createElement("div",{className:this.props.className},a,wp.element.createElement("div",{className:"oer-allftrdrsrccntr"},l))]}}]),n}(h));d("wp-oer-plugin/oer-subject-resources-block",{title:m("OER Subject Resources"),category:"widgets",icon:{foreground:"#121212",src:"media-document"},keywords:[m("OER"),m("Resource"),m("Subject Areas")],attributes:{content:{type:"string",selector:"p"},title:{type:"string",selector:"h2"},link:{type:"string",selector:"a"},displayCount:{type:"string"},selectedSubject:{type:"number",default:0},sort:{type:"string",default:"dateupdated"},selectedSubjectResources:{type:"array"},subjects:{type:"array"},selectedSubjects:{type:"array"},childSubjects:{type:"array"}},edit:w,save:function(e){var t,n=[{value:"modified",label:m("Date Updated")},{value:"date",label:m("Date Added")},{value:"title",label:m("Title a-z")}],s=m("Browse %d resources"),r=[];if(void 0!==e.attributes.selectedSubjectResources&&e.attributes.selectedSubjectResources.length>0){t=n.map((function(e,t){return wp.element.createElement("option",{value:e.value},e.label)}));var l=s.replace("%d",this.state.selectedSubjectResources.length);s=wp.element.createElement("div",{className:"oer-snglrsrchdng"},l,wp.element.createElement("div",{class:"sort-box"},t)),e.attributes.selectedSubjectResources.map((function(e,t){var n=[];e.subject_details.map((function(e,t){n.push(wp.element.createElement("span",null,wp.element.createElement("a",{href:e.link},e.name)))})),r.push(wp.element.createElement("div",{className:"post oer-snglrsrc"},wp.element.createElement("a",{href:e.link,className:"oer-resource-link"},wp.element.createElement("div",{className:"oer-snglimglft"},wp.element.createElement("img",{src:e.fimg_url}))),wp.element.createElement("div",{className:"oer-snglttldscrght"},wp.element.createElement("div",{className:"ttl"},wp.element.createElement("a",{href:e.link},wp.element.createElement("h2",{dangerouslySetInnerHTML:{__html:e.title.rendered}}))),wp.element.createElement("div",{className:"post-meta"},wp.element.createElement("span",{className:"post-meta-box post-meta-grades"},wp.element.createElement("strong",null,"Grades: "),e.oer_grade),wp.element.createElement("span",{className:"post-meta-box post-meta-domain"},wp.element.createElement("strong",null,"Domain: "),wp.element.createElement("a",{href:e.link,target:"_blank"},e.domain))),wp.element.createElement("div",{className:"desc"},wp.element.createElement("p",{dangerouslySetInnerHTML:{__html:e.content.rendered}})),wp.element.createElement("div",{className:"tagcloud"},n))))}))}return wp.element.createElement("div",{className:e.className},s,wp.element.createElement("div",{className:"oer-allftrdrsrccntr"},r))}})}]);